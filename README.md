# Analysis Ready Gravity Data Workflow

This repository introduces an open-source tool for computing regional gravimetric geoids using gravity observations. Our primary goal is to create a platform for analysis-ready gravity data, where algorithms and code for working with gravity data are openly shared and improved. The initial release features a tile-wise least-squares collocation (LSC) method based on gravity anomaly observations.

![18-Jun-2024vicNSWterrMosaicTilesresidualGeoidvsAGQG (2)](https://github.com/user-attachments/assets/4444d059-cf1b-411a-8b2a-2196175c7f08)

Comparing the quasi-geoid calculated from Least Squares Collocation (LSC) (left) with the existing Australian gravimetric quasi-geoid (AGQG) (right). 

## Overview

This self-contained codebase provides three major steps for geoid calculation:
1. **Topographic corrections to gravity anomalies**
2. **Calculation of covariance functions**
3. **Performing least squares collocation (LSC)**

The code is designed as a starting point for research and development in geoid calculation using a variety of gravity data, such as terrestrial gravity anomalies, gravity anomalies from satellite altimetry, airborne gravity anomalies, and gravity gradients.

## Workflow

The workflow for generating the geoid from gravity observations can be found in `RunDemo.m`. This script is highly flexible and can be adapted to different regions and processing requirements. Designed to be run on a personal computer, `RunDemo.m` allows users to specify an area of interest and directories where the final plots will be saved.

In `RunDemo.m`, all necessary specifications are defined. The script first calls the functions needed to apply topographic corrections to the gravity observations within the area of interest. It then performs the geoid calculation by dividing the area into tiles, which reduces the matrix sizes for easier inversion.

At the end of the process, `RunDemo.m` combines all the tiles and outputs the geoid in TIFF format for the specified region.

To run `RunDemo.m`, you can download the required input data from the following links:

- [oneTileData141-32.mat](https://geoid.s3-ap-southeast-2.amazonaws.com/AGQG/oneTileData141-32.mat)
- [oneTileGriddedInterpolant141-32.mat](https://geoid.s3-ap-southeast-2.amazonaws.com/AGQG/oneTileGriddedInterpolant141-32.mat)

Detailed output files and plots generated by `RunDemo.m` are available in the `document` folder.

## Remove-Predict-Restore

In summary, for computing a geoid from gravity anomalies, the process can be conceptualized as a sequence of "remove-predict-restore" operations, where the Global Gravity Model (GGM) and topographic effects are removed, a geoid is predicted (here with LSC), and then the effects are restored to obtain the final geoid model. The `functions` folder provides all the MATLAB functions to perform these three steps for geoid calculations.

## Usage

The code can be run using the `Run*.m` scripts.
All functions are in the `functions` folder. The hierarchy of the three main scripts and their related functions is listed in the table below.

## Function Structure in `Run*.m`

| **Function Group**                                | **Function Name**                               |
|---------------------------------------------------|-------------------------------------------------|
| `importAndFormatData.m`                           |                                                 |
|                                                   |                                                 |
| `computeTerrainEffect.m`                          | `computeTerrainCorrection.m`                    |
|                                                   | `computePrismGravity.m`                         |
|                                                   | `computeNagyFormula.m`                          |
|                                                   |                                                 |
|                                                   | `filterDEM.m`                                   |
|                                                   |                                                 |
|                                                   | `computeCovarianceFunctionParameters.m`         |
|                                                   | `computeSphericalEmpiricalCovariance.m`         |
|                                                   | `fitEmpiricalCovariance.m`                      |
|                                                   | `precomputeCovarianceFunction.m`                |
|                                                   | `interpolateCovarianceFunction.m`               |
|             `computeGravimetryLSC.m`              | `solveGravityLSCmatrix.m`                       |
|             `computeGradiometryLSC.m`             | `solveGradientLSCmatrix.m`                      |
|             `computeGravimetryGradiometryLSC.m`   | `solveGravityGradientLSCmatrix.m`               |
|                                                   | `createGridWeights.m`                           |
|                                                   | `comparetoLevellingData.m`                      |



## Citations

If you use this code in your research, please contact [neda.darbeheshti@ga.gov.au](mailto:neda.darbeheshti@ga.gov.au) for citation information.



